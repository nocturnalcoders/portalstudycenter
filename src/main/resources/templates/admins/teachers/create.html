<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/headerCommon :: head">
  <meta charset="UTF-8">
  <title>Notification MConnect</title>
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
  <header th:replace="fragments/mainHeaderCommon::mainHeader" class="main-header">
  </header>
  <aside class="main-sidebar">
    <section class="sidebar" th:replace="fragments/menuCommon::menu"></section>
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <div class="col-8 p-15">
                <h3 class="card-title" th:utext="${pageTitle}"></h3>
                <h5 class="card-subtitle"><a th:href="@{'/dashboard'}">Dashboard</a> /
                  <span th:utext="${pageTitle}"></span> /
                  <span th:utext="${pageSubTitle}"></span>
                </h5>
              </div>
            </div>
          </div>
          <form th:action="@{/notificationMConnect/add}" method="POST" th:object="${holder}"
                enctype="multipart/form-data" id="notificationForm" role="form">
            <div class="row">
              <div class="col-md-8">
                <div class="box">
                  <div class="box-body">
                    <div class="box-header">
                      <div class="col-md-12">
                        <h3 class="card-title">New Students</h3>
                      </div>
                    </div>
                    <div class="box-body">
                      <div class="col-md-12">
                        <div class="form-group col-md-12">
                          <div class="form-group">
                            <label class="form-label">Title
                              Notification</label>
                            <input type="text" class="form-control tit" id="titleParam"
                                   name="titleParam" placeholder="Input your title" required maxlength="65">
                            <p class="character-counts"></p>
                          </div>
                          <div class="form-group">
                            <label class="form-label">Message Notification</label>
                            <textarea class="form-control mes" id="param" name="param"
                                      placeholder="Input your Message"
                                      rows="3" required maxlength="113"> </textarea>
                            <p class="character-count"></p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="box-footer col-md-12">
                      <button id="btnSubmit" type="submit" onClick="refreshPage()"
                              class="btn btn-primary" data-toggle="modal" data-target="#myModal" >Submit</button>
                    </div>
                  </div>
                  <!-- /.col -->
                </div>

              </div>
            </div>
          </form>
          <!-- /.col -->
        </div>
      </div>

      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <div th:replace="fragments/footerCommon::footer" th:remove="tag"></div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Data ready to create</h4>
      </div>
      <div class="modal-body">
        <p>Wait Until Loading is Finished</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
<!-- Datatables -->
<script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"
        src="../../static/plugins/datatables/jquery.dataTables.min.js"></script>
<script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.min.js}"
        src="../../static/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script th:src="@{/assets/js/clipboard/clipboard.min.js}"
        src="../../static/assets/js/clipboard/clipboard.min.js"></script>
<script th:src="@{/assets/plugins/slimScroll/jquery.slimscroll.min.js}"
        src="../../static/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script th:src="@{/assets/plugins/fastclick/fastclick.js}"
        src="../../static/plugins/fastclick/fastclick.js"></script>
<script th:inline="javascript">
  for (var i = 0; i < document.getElementsByClassName("form-control mes").length; i++) {
    document.getElementsByClassName("form-control mes")[i].onkeyup = function (i) {
      return function () {
        console.log(this);
        var text_max = 113;
        var text_length = this.value.length;
        var text_remaining = text_max - text_length;
        document.getElementsByClassName("character-count")[i].innerHTML = "Character count:" + text_length + "/" + text_max;
      };
    }(i);
  }

  for (var i = 0; i < document.getElementsByClassName("form-control tit").length; i++) {
    document.getElementsByClassName("form-control tit")[i].onkeyup = function (i) {
      return function () {
        console.log(this);
        var text_max = 65;
        var text_length = this.value.length;
        var text_remaining = text_max - text_length;
        document.getElementsByClassName("character-counts")[i].innerHTML = "Character count:" + text_length + "/" + text_max;
      };
    }(i);
  }


  $(document).ready(function() {
    $('.btn-primary').attr('disabled', true);
    if ($('#titleParam').on('keyup', function () {
      if ($('#param').on('keyup', function () {
        if ($('#titleParam').val().length != 0 && $('#param').val().length != 0) {
          $('.btn-primary').attr('disabled', false);
        } else {
          $('.btn-primary').attr('disabled', true);
        }
      }));
    }));
  });

  $(document).ready(function () {

    $('#nasabahType').change(() => {
      const data = {
        id: 0,
        filterName: "",
        flagActive: 1,
        filterDescription: "",
        value1: "",
        value2: "",
        orderNo: 1,
        filterType: "",
        policyType: $('#nasabahType').val()
      }
      if($('#nasabahType').val() == "All" ||$('#nasabahType').val() == " ") {
        $('#filterName, #filterValue').prop('disabled', true);
        $('#filterValue').prop('selectedIndex',0);
      } else {
        $('#filterName, #filterValue').prop('disabled', false);
        $('#filterValue').prop('selectedIndex',0);
      }

      $.ajax({
        type: 'POST',
        url: 'https://uat-marcomm-cms-ws.generali.co.id/parameter/search',
        data: JSON.stringify(data),
        dataType: "json",
        contentType: "application/json",
        success: (res) => {
          let html;
          html += "<option value=''>"+"--SELECT--"+"</option>"
          res.data.forEach(el => {
            html += "<option value='" + el.filterName + "'>" + el.filterName + "</option>"
          })
          console.log(res)
          $('#filterName').html(html);
        },
        error: (err) => {
          console.log(err)
        }
      })
    })
    $('#filterName').change(() => {
      const data = {
        id: 0,
        filterName: $('#filterName').val(),
        flagActive: 1,
        filterDescription: "",
        value1: "",
        value2: "",
        orderNo: 0,
        paramDesc: "",
        filterType: "",
        policyType: $('#nasabahType').val()
      }

      $.ajax({
        type: 'POST',
        url: 'https://uat-marcomm-cms-ws.generali.co.id/parameter/search',
        data: JSON.stringify(data),
        dataType: "json",
        contentType: "application/json",
        success: (res) => {
          let html;
          html += "<option value=' '>"+"--SELECT--"+"</option>"
          res.data.forEach(el => {
            html += "<option value='" + el.value1 + "'>" + el.filterDescription + "</option>"
          })
          console.log(res)
          $('#filterValue').html(html);
        },
        error: (err) => {
          console.log(err)
        }
      })
    })
    $('#filterValue').change(() => {
      const data = {
        id: 0,
        filterName: $('#filterName').val(),
        flagActive: 1,
        filterDescription: "",
        value1: $('#filterValue').val(),
        value2: "",
        orderNo: 0,
        paramDesc: "",
        filterType: "",
        policyType: $('#nasabahType').val()
      }

      $.ajax({
        type: 'POST',
        url: 'https://uat-marcomm-cms-ws.generali.co.id/parameter/search',
        data: JSON.stringify(data),
        dataType: "json",
        contentType: "application/json",
        error: (err) => {
          console.log(err)
        }
      })
    })
  });
</script>
</body>

</html>